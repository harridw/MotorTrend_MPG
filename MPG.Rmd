---
title: "Statistical Inference: MotorTrend_MPG"
author: "EHarris"
date: "7/18/2017"
output: html_document
---

## Packages for Course 7 Project: Motor Trend MPG
```{r setup, include = TRUE, echo = FALSE, results = "hide"}
ipak <- function(pkg){
      new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
      if (length(new.pkg)) 
            install.packages(new.pkg, dependencies = TRUE)
      sapply(pkg, require, character.only = TRUE)
}

### Package Usage
packages <- c("plyr", "dplyr", "data.table", "dtplyr", "lubridate", "ggplot2", "scales",
                  "reshape2", "knitr", "R.cache", "stringr", "gtools", "quantreg",
                  "graphics", "corrplot", "broom")
ipak(packages)
```

## Overview  
You work for Motor Trend, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). They are particularly interested in the following two questions:

* Is an automatic or manual transmission better for MPG?
* Quantify the MPG difference between automatic and manual transmissions"  

A first step in the analysis is to look at the effect of transmission type, automatic vs. manual, on miles per gallon (MPG).  Without much review of the dataset, it may be reasonable to expect that a manual transmission vehicle is associated with higher MPG.  Further review will uncover other items, such as vehicle weight and the number of cylinders (e.g. 4, 6, 8), that may contribute more significantly to the mileage of a vehicle.


## Load Data  
Given that this is an R dataset we can simply use data(ToothGrowth) to load the dataset into the current enviromnent.  
```{r load_mtcars, include = TRUE, echo = TRUE}
data(mtcars)
```


## Exploratory Data Analysis  
Our exploratory analysis provides some quick insigtht to the data of 'mtcars' data set.  We provide a chart of the correlation for each variable and two panel plots.  One of the panel plots, representing line graphs of the relationship for each variable, is illustrated in the Appendix.  The other panel plot, illustrated below in Exhibit 2, provides additional information about the relationship of variables to mpg.  The correlation matrix is used to determine which variables are included in the panel plot, based on correlation factor with absolute value > 0.5.


### Summary view of dataset
```{r dataset_overview, include = TRUE, echo = TRUE, results = "hold"}
str(mtcars)
head(mtcars)
summary(mtcars)
```


### Correlation Matrix (Upper Triangle)
This table provides an easy way to look at the relationship between the different variables of the 'mtcars' dataset.  Along the diagonal, we see a value of 1, representing the correlation of a variable(e.g. mpg) and itself.  A correlation factor, or value, is between -1 and 1.  A positive correlation factir indicates that a variable changes directionally with another defined variable.  A negative correlation suggests that two variables move in opposite directions.  The closer the correlation factor is to zero indicates lower correlation.  As correlation moves closer to -1 or 1, the stroger is the correlation or relationship.

#### Exhibit 1: Correlation Factor Matrix
```{r corr_matrix_grid, include = TRUE, echo = TRUE, results = "asis"}
corr.grid <- corrplot(round(cor(mtcars[,1:11]), 3), method = "number", type = "upper")
corr.grid
```

```{r mpg_corr_grid, include = FALSE, echo = FALSE, results = "hide"}
mpg.corr <- round(cor(mtcars[,1:11]), 3)[1,]
mpg.cyl <- mpg.cor[2]
mpg.disp <- mpg.cor[3]
mpg.hp <- mpg.cor[4]
mpg.drat <- mpg.cor[5]
mpg.wt <- mpg.cor[6]
mpg.qsec <- mpg.cor[7]
mpg.vs <- mpg.cor[8]
mpg.am <- mpg.cor[9]
mpg.gear <- mpg.cor[10]
mpg.carb <- mpg.cor[11]
```


### Relationship of Variables
Along with the table of correlation factors, the panel plots (see Appendix Figure 1 and Figure 2) provides additional insight to the relation of each variable to MPG as well as each other. These plots, along with the correlation matrix, are considered for purpose of the further analysis, including regression analysis.


## Regression Analysis
The focus of our analysis is miles per gallon (MPG).  More specifically, we want to understand what variables or terms influence the mpg of a car.  It might be reasonable and/or appropriate to include all variables within the 'mtcars' dataset to predict the mpg of a car.  However, we likely want to explore and understand whether each variable contributes to the estimate.  If we look at the correlation matrix, you can see that the variables 'cyl', 'disp', and 'wt' are similarly correlated with mpg, -0.85, -0.85, and -0.87 respectively.  This strong relationship is further suggested when we look at the correlation factor between these variables: 'cyl'~'disp' = 0.9;  'cyl'~'wt' = 0.78; and 'disp'~'wt' = 0.89.  We'll start with looking at 'mpg' related to the variable 'am', transmission (automatic vs. manual).


### Automatic versus Manual Regression
The initial model looks at the effect of transmission type (automatic vs. manual) on the miles per gallon (MPG) of a car.  It is important to note that the variable 'am' contains a 0 (automatic) or 1 (manual).  So the baseline, or intercept, reflects the average mpg for a car with automatic transmission.  The 'am' coefficient represents the average change in mpg for a car with manual transmission.


#### Exhibit 4: Simple Linear Regression (mpg ~ am)
This simple linear regression produces an intercept of 17.147 mpg.  If the car has a manual transmission, we would estimate an additional 7.25 mpg.  As previously stated, it is idealistic to assume that the type of transmission, automatic vs. manual, could define the mpg of a car.  This is further validated by a relatively low adjusted r.square of 0.3385, meaning that roughly 34% of the change in mpg is explained by transmission type alone.

```{r slr_mpg_am, include = TRUE, echo = TRUE, results = "asis"}
fit1 <- lm(mpg ~ am, data = mtcars)
fit1coef <- round(summary(fit1)$coef, 4)
fit1glance <- round(glance(fit1)[1:6], 4)
fit1coef
fit1glance
```


### Automatic versus Manual (Multivariable Regression)
To build a multivariable regression that best fits the data, we could add one variable, or term, at a time.  The goal is to avoid underfitting or overfitting the model.  Therefore, we want to include variables that minimizes the residual, maximizes adjusted r.square, and statistically significant (anova results). We will review our exploratory analysis to add variables, no more than 2 variables at a time.


#### Exhibit 5: Multivariable Regression (mpg ~ am + wt)
```{r slr_mpg_am_one, include = TRUE, echo = TRUE, results = "asis"}
fit2 <- lm(mpg ~ am + wt, data = mtcars)
fit2coef <- round(summary(fit2)$coef, 4)
fit2glance <- round(glance(fit2)[1:6], 4)
fit2coef
fit2glance
```

#### Exhibit 6: Multivariable Regression (mpg ~ am + wt + cyl)
```{r slr_mpg_am_two, include = TRUE, echo = TRUE, results = "asis"}
fit3 <- lm(mpg ~ am + wt + cyl, data = mtcars)
fit3coef <- round(summary(fit3)$coef, 4)
fit3glance <- round(glance(fit3)[1:6], 4)
fit3coef
fit3glance
```

#### Exhibit 7: Multivariable Regression (mpg ~ am + wt + cyl + hp)
```{r slr_mpg_am_three, include = TRUE, echo = TRUE, results = "asis"}
fit4 <- lm(mpg ~ am + wt + cyl + hp, data = mtcars)
fit4coef <- round(summary(fit4)$coef, 4)
fit4glance <- round(glance(fit4)[1:6], 4)
fit4coef
fit4glance
```


#### Exhibit 8: Multivariable Regression (include all independent variables)
```{r slr_mpg_am_nine, include = TRUE, echo = TRUE, results = "asis"}
fit10 <- lm(mpg ~ ., data = mtcars)
fit10coef <- round(summary(fit10)$coef, 4)
fit10glance <- round(glance(fit10)[1:6], 4)
fit10coef
fit10glance
```


#### Exhibit 9: ANOVA
```{r}
mpg.anova <- anova(fit1, fit2, fit3, fit4, fit10)
```





### T-test: Difference in Tooth Growth by Supplement
The first step is to split data by supplement('supp').  We will use the t.test() function in R to evaluate whether the tooth length is longer when the supplement 'OJ' is used compared to 'VC' across all dose levels.  The boxplot might indicate that the supplement 'OJ' promotes greater tooth growth than 'VC'.  We will use a one-sided (right) to evaluate
```{r supp_ttl_difference, include = TRUE, echo = TRUE, results = "hold"}
vc_ttl <- select(subset(ToothGrowth, supp == "VC"), supp, len)
oj_ttl <- select(subset(ToothGrowth, supp == "OJ"), supp, len)

t.test(oj_ttl$len,vc_ttl$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


The t.test results in a p-value = 0.03032. As this is less than our target $\alpha =$ 0.05, we reject the NULL hypothesis that there is no significant difference in favor of the alternative hypothesis, $H_a$, that 'OJ' promotes greater tooth growth than the supplement 'VC'.


### T-test: Difference in Tooth Growth by Supplement with a dose level
We are focus on the difference in tooth growth produced by a supplement and dose level.  Before applying t.test(), we will subset data to reflect ths specified populations.  We will create 6 data subsets, each represent a specific supp and dose.  For example, vc05 represents data for the supp 'VC' at a 0.5 dose level.  Similarly, oj10 reprsents data for the supp 'OJ' and dose level of 1.0.


##### T-test: Greater Tooth Growth with the supplement 'OJ' versus 'VC' at dose = 0.5
```{r supp_dose05_difference, include = TRUE, echo = TRUE, results = "hold"}
vc05 <- select(subset(ToothGrowth, supp == "VC" & dose == 0.5), supp, len)
vc10 <- select(subset(ToothGrowth, supp == "VC" & dose == 1.0), supp, len)
vc20 <- select(subset(ToothGrowth, supp == "VC" & dose == 2.0), supp, len)
oj05 <- select(subset(ToothGrowth, supp == "OJ" & dose == 0.5), supp, len)
oj10 <- select(subset(ToothGrowth, supp == "OJ" & dose == 1.0), supp, len)
oj20 <- select(subset(ToothGrowth, supp == "OJ" & dose == 2.0), supp, len)

t.test(oj05$len,vc05$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


We are testing whether we would reject the NULL hypothesis that tooth growth for 'VC' and 'OJ' are similar at a dose = 0.5.  The alternative hypothesis, $H_a$, is that 'OJ' promotes greater tooth growth at dose = 0.5.  Performing a t-test we obtained a p-value = 0.003179. This is less than our target $\alpha =$ 0.05 so we reject the NULL hypothesis in favor of the alternative hypothesis, supp 'OJ' promotes greater tooth growth than 'VC' at a dose = 0.05.


##### T-test: Greater Tooth Growth with the supplement 'OJ' versus 'VC' at dose = 1.0
```{r supp_dose10_difference, include = TRUE, echo = TRUE, results = "hold"}
t.test(oj10$len,vc10$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


At a dose = 0.5, the t.test calculated p-value = 0.0005192 is very small, well below the threshold $\alpha =$ 0.05. We reject the NULL hypothesis in favor of the alternative hypothesis, $H_a$: $\mu_{oj}$ > $\mu_{vc}$, that the supplement 'OJ' promotes greater tooth growth than the supplement'VC'.


##### T-test: Difference in Tooth Growth by Supplement with dose = 2.0
```{r supp_dose20_difference, include = TRUE, echo = TRUE, results = "hold"}
t.test(oj20$len,vc20$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


Our final t.test, comparing tooth growth for supplements 'OJ' and 'VC', reflects a dose = 2.0.  If you recall, the boxplot might suggest that there is no significant different in the mean tooth growth for the two supplements.  The t.test, p-value =  0.5181 is rather larger, well above the threshold $\alpha =$ 0.05. We accept the NULL hypothesis which is consistent with what we expected by looking at our boxplot.


### T-test: Difference in Tooth Growth due to dose
The overall goal is to determine whether increasing the dose of a supplement('supp') results in greater tooth growth.  Because results are not different at the 95% confidence interval we might be able to compare data without regard to the type of supplement.  We have elected to look at the effects of dose within each supplement. For each supplement, separately, we will compare tooth length for the different dose levels.  The initial comparison is tooth length with a dose = 2.0 to a dose = 0.5.


##### Tooth Growth: Supp ('OJ') by comparing dose [0.5, 2.0]
```{r tooth_growth_dose_max_oj, include = TRUE, echo = TRUE, results = "hold"}
t.test(oj20$len,oj05$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


In this test, we seek to evaluate whether, for the supplement 'OJ', a dose = 2.0 promotes greater tooth growth than a dose = 0.05.  Base on t.test p-value = 6.619e-07 (0.0000006619), very small, we reject the NULL hypothesis that there is no difference in tooth growth between the dose levels, 0.5 & 2.0.  In other words, the t.test results suggest that there is greater tooth growth with a dose = 2.0 versus a dose = 0.5.


##### Tooth Growth: Supp ('VC') by comparing dose [0.5, 2.0]
```{r tooth_growth_dose_max_vc, include = TRUE, echo = TRUE, results = "hold"}
t.test(vc20$len,vc05$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


Results for the supplement = 'VC' are consistent with 'OJ'.   With a p-value = 4.682e-08 (0.00000004682), also very small, we reject the NULL hypothesis.  Again, this confirms that, at a 95% confidence level, there is greater tooth growth associated with the supplement 'VC' at a dose = 2.0 versus a dose = 0.5.


#### Tooth Growth:  Significant for interim dose levels
Although it appears to be clear that there is greater tooth growth for a higher dose, 2.0 versus 0.5, of either supplement, 'VC' and 'OJ', we wish to determine whether tooth growth is greater for interim dose levels (e.g. dose = 1.0 versus dose = 0.5 and does = 2.0 versus dose = 1.0).


##### Tooth Growth: Supp ('OJ') by comparing interim dose [1.0 versus 0.5]
```{r tooth_growth_dose_interim1_oj, include = TRUE, echo = TRUE, results = "hold"}
t.test(oj10$len,oj05$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


##### Tooth Growth: Supp ('OJ') by comparing interim dose [2.0 versus 1.0]
```{r tooth_growth_dose_interim2_oj, include = TRUE, echo = TRUE, results = "hold"}
t.test(oj20$len,oj10$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


For the supplement 'OJ', the p-value for each of the interim dose increases are below our threshold of $\alpha =$ 0.05, 4.392e-05 (0.00004392) and 0.0196, respectively.  We reject the NULL hypothesis for both incremental dose levels.  Tooth growth associated with the higher dose of the supplement 'OJ' is greater than the lower dose of the supplement 'OJ'.


##### Tooth Growth: Supp ('VC') by comparing interim dose [1.0 versus 0.5]
```{r tooth_growth_dose_interim1_vc, include = TRUE, echo = TRUE, results = "hold"}
t.test(vc10$len,vc05$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


##### Tooth Growth: Supp ('VC') by comparing interim dose [2.0 versus 1.0]
```{r tooth_growth_dose_interim2_vc, include = TRUE, echo = TRUE, results = "hold"}
t.test(vc20$len,vc10$len, paired = FALSE, var.equal = FALSE, alternative = "greater")
```


For the supplement 'VC', similar to results for the supplement 'OJ', the p-value for each of the interim dose increases are below our threshold of $\alpha =$ 0.05, 3.406e-07 (0.0000003406) and 4.578e-05 (0.00004578), respectively.  We reject the NULL hypothesis for both incremental dose levels.  Tooth growth associated with the higher dose of the supplement 'VC' is greater than the lower dose of the supplement 'VC'.


## Conclusion
Following our review of Exploratory Data Analysis, it was decided to test two assumptions.  From the boxplot, it appeared that the supplement 'OJ' promoted greater tooth growth than the supplement 'VC'.  It was also apparent that a higher dose promoted greater tooth growth, regardless of supplement introduced.  We chose to test these assumptions by setting NULL hypothesis that there was no difference in the tooth growth for supplement 'OJ' versus 'VC' and a higher dose versus lower dose.  The alternative hypothesis being that 'OJ' promotes greater tooth growth than 'VC' and a higher dose promotes greater tooth growth than a lower dose.

From our t.test, the p-values were rather small, with the exception of testing whether 'OJ' promotes greater tooth growth than 'VC' at a dose = 2.0, indicating that we reject the NULL hypothesis.  In summary, the analysis suggests that 'OJ' promotes greater tooth growth than 'VC'.  Additionally, regardless of the supplement selected, 'OJ' or 'VC', a higher dose of the supplement promotes greater tooth growth than lower dose.

## Appendix
The information provided below is an outline of the request or question driving this assingment and analysis of data for different cars and related miles per gallon (MPG).

## Instructions

You work for Motor Trend, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). They are particularly interested in the following two questions:

“Is an automatic or manual transmission better for MPG”
"Quantify the MPG difference between automatic and manual transmissions"

### Review criteria

#### Peer Grading
The criteria that your classmates will use to evaluate and grade your work are shown below.
Each criteria is binary: (1 point = criteria met acceptably; 0 points = criteria not met acceptably)

#### Criteria
1. Did the student interpret the coefficients correctly?
2. Did the student do some exploratory data analyses?
3. Did the student fit multiple models and detail their strategy for model selection?
4. Did the student answer the questions of interest or detail why the question(s) is (are) not answerable?
5. Did the student do a residual plot and some diagnostics?
6. Did the student quantify the uncertainty in their conclusions and/or perform an inference correctly?
7. Was the report brief (about 2 pages long) for the main body of the report and no longer than 5 with supporting appendix of figures?
8. Did the report include an executive summary?
9. Was the report done in Rmd (knitr)?


### Figure 1 (Panel Plot): Illustrate the relationship of each variable
This panel plot provides a quick, high-level, illustration of a variable within the dataset against each other variable in the dataset.  The pu
```{r panel_plot_exploratory, fig.keep = "high", fig.show = "asis", fig.path = 'figure/'}
pairs(mtcars, panel = panel.smooth, main = "MT Cars Data", col = 3)
```

#### Figure 2: Variable Relationship to Miles per Gallon (MPG)
This panel plot illustrates the relationship of variables with a high correlation, absolute value > 0.50, with the mpg.  Where it made sense boxplots are used, dotplots in other instances.
```{r panel_plot_high_corr, fig.keep = "high", fig.show = "asis", fig.path = 'figure/'}
par(mfrow = c(2,4), mar = c(6,4,1,1))
g1 <- ggplot(mtcars, aes(x = cyl, y = mpg, group = cyl)) +
            geom_boxplot(width = 0.5) +
            labs(x = "# Cylinders", y = "MPG")
g1
g2 <- ggplot(mtcars, aes(x = disp, y = mpg, group = disp)) +
            geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.75, binwidth = 0.5) +
            labs(x = "disp", y = "MPG")
g2
g3 <- ggplot(mtcars, aes(x = hp, y = mpg, group = hp)) +
            geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.75, binwidth = 0.5) +
            labs(x = "Horespower", y = "MPG")
g3
g4 <- ggplot(mtcars, aes(x = drat, y = mpg, group = drat)) +
            geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.75, binwidth = 0.5) +
            labs(x = "drat", y = "MPG")
g4
g5 <- ggplot(mtcars, aes(x = wt, y = mpg, group = wt)) +
            geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.75, binwidth = 0.5) +
            labs(x = "Weight", y = "MPG")
g5
g6 <- ggplot(mtcars, aes(x = vs, y = mpg, group = vs)) +
            geom_boxplot(width = 0.5) +
            labs(x = "vs", y = "MPG")
g6
g7 <- ggplot(mtcars, aes(x = am, y = mpg, group = am)) +
            geom_boxplot(width = 0.5) +
            labs(x = "Auto/Manual", y = "MPG")
g7
g8 <- ggplot(mtcars, aes(x = carb, y = mpg, group = carb)) +
            geom_boxplot(width = 0.5) +
            labs(x = "Carberator", y = "MPG")
g8
```
